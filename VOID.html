<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="voidicon.png" type="image/png">
    <audio src="mary.mp3" autoplay loop></audio>
    <audio id="boys-audio" src="boys.mp3" loop></audio>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let inputBuffer = '';
        const targetKeyword = 'gay';
        const audioElement = document.getElementById('boys-audio');

        function playAudio() {
            document.querySelectorAll('audio').forEach(audio => {
                if (audio !== audioElement) {
                    audio.pause();
                    audio.currentTime = 0;
                }
            });
            audioElement.play();
        }

        document.addEventListener('keydown', (event) => {
            inputBuffer += event.key.toLowerCase();
            if (inputBuffer.length > targetKeyword.length) {
                inputBuffer = inputBuffer.slice(-targetKeyword.length);
            }
            if (inputBuffer === targetKeyword) {
                playAudio();
            }
        });
    });
    </script>

    <meta charset="UTF-8">
    <title>VOID</title>

    <style>
        body { margin: 0; overflow: hidden; background: black; color: white; }
        #hud { position: absolute; top: 10px; left: 10px; z-index: 5; }
        #message, #completeMessage {
            display: none;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            z-index: 10;
        }
        #message { color: red; cursor: pointer; }
        #completeMessage { color: lightblue; }
        #levelIntro {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 36px;
            display: none;
        }
    </style>
</head>
<body>

<div id="hud">Level: 1 | Points: 0</div>
<div id="levelIntro">LEVEL 1</div>
<div id="message" onclick="location.reload()">failed.</div>
<div id="completeMessage">complete.</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
const SAFE_RADIUS = 1.8;

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0,4,6);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0x404060,1.2));
const light = new THREE.DirectionalLight(0xffffff,1.1);
light.position.set(4,8,6);
scene.add(light);

scene.add(new THREE.GridHelper(20,20));

const player = new THREE.Mesh(
    new THREE.BoxGeometry(0.5,0.5,0.5),
    new THREE.MeshPhongMaterial({color:0xbbbbbb})
);
player.position.y = 0.25;
scene.add(player);

const target = new THREE.Mesh(
    new THREE.BoxGeometry(0.5,0.5,0.5),
    new THREE.MeshPhongMaterial({color:0x66ff66})
);
target.position.set(0,0.25,-2.5);
scene.add(target);

let spikes = [];
let level = 1;
let points = 0;
let invincible = false;

function isValidSpikePosition(pos) {
    return (
        pos.distanceTo(player.position) > SAFE_RADIUS &&
        pos.distanceTo(target.position) > 1.5
    );
}

function resetPlayerPosition() {
    let pos;
    do {
        pos = new THREE.Vector3(
            Math.random()*6-3,
            0.25,
            Math.random()*6-3
        );
    } while (pos.distanceTo(target.position) < 2);

    player.position.copy(pos);
}

function createSpikesForLevel() {
    spikes.forEach(s => scene.remove(s));
    spikes = [];

    const count = Math.min(6 + level, 32);

    for (let i=0;i<count;i++) {
        let pos;
        do {
            pos = new THREE.Vector3(
                Math.random()*10-5,
                0.5,
                Math.random()*10-5
            );
        } while (!isValidSpikePosition(pos));

        const spike = new THREE.Mesh(
            new THREE.ConeGeometry(0.25,1.2,24),
            new THREE.MeshPhongMaterial({color:0xAE4305})
        );
        spike.position.copy(pos);
        scene.add(spike);
        spikes.push(spike);
    }
}

function resetLevel() {
    resetPlayerPosition();      // ðŸ”’ player first
    createSpikesForLevel();     // ðŸ”’ spikes after
    invincible = true;
    setTimeout(()=>invincible=false,500);
    document.getElementById('levelIntro').textContent = `LEVEL ${level}`;
    document.getElementById('levelIntro').style.display = 'block';
    setTimeout(()=>document.getElementById('levelIntro').style.display='none',500);
}

resetLevel();

function animate() {
    requestAnimationFrame(animate);

    for (const s of spikes) {
        if (!invincible && player.position.distanceTo(s.position) < 0.5) {
            document.getElementById('message').style.display = 'block';
            renderer.domElement.style.display = 'none';
            return;
        }
    }

    if (player.position.distanceTo(target.position) < 0.5) {
        level++;
        if (level > 50) {
            document.getElementById('completeMessage').style.display = 'block';
            renderer.domElement.style.display = 'none';
        } else resetLevel();
    }

    camera.lookAt(player.position);
    renderer.render(scene,camera);
}
animate();

window.addEventListener('resize',()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
});
</script>
</body>
</html>
